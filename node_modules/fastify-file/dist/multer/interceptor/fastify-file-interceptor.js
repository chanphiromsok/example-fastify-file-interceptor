"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.FastifyFileInterceptor = void 0;
const tslib_1 = require("tslib");
const common_1 = require("@nestjs/common");
const fastify_multer_1 = tslib_1.__importDefault(require("fastify-multer"));
const multer_module_option_1 = require("../constant/multer-module-option");
function FastifyFileInterceptor(fieldName, localOptions) {
    let MixinInterceptor = class MixinInterceptor {
        constructor(options) {
            this.multer = fastify_multer_1.default(Object.assign(Object.assign({}, options), localOptions));
        }
        intercept(context, next) {
            return tslib_1.__awaiter(this, void 0, void 0, function* () {
                const ctx = context.switchToHttp();
                yield new Promise((resolve, reject) => this.multer.single(fieldName)(ctx.getRequest(), ctx.getResponse(), (error) => {
                    if (error) {
                        return reject(error);
                    }
                    resolve();
                }));
                return next.handle();
            });
        }
    };
    MixinInterceptor = tslib_1.__decorate([
        tslib_1.__param(0, common_1.Optional()),
        tslib_1.__param(0, common_1.Inject(multer_module_option_1.MULTER_MODULE_OPTION)),
        tslib_1.__metadata("design:paramtypes", [Object])
    ], MixinInterceptor);
    const Interceptor = common_1.mixin(MixinInterceptor);
    return Interceptor;
}
exports.FastifyFileInterceptor = FastifyFileInterceptor;
//# sourceMappingURL=fastify-file-interceptor.js.map